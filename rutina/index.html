<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan de Entrenamiento Interactivo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, deleteDoc, onSnapshot, doc, query } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

        // Expose Firebase functions to the global window object for easier access in the main script
        window.firebase = { initializeApp, getAuth, signInAnonymously, onAuthStateChanged, getFirestore, collection, addDoc, deleteDoc, onSnapshot, doc, query };
    </script>
    <style>
        /* Tus estilos CSS existentes */
        body { font-family: 'Inter', sans-serif; transition: background-color 0.3s ease, color 0.3s ease; }

        /* Light Theme (Default / Normal) */
        body.light-theme {
            --bg-primary: #f8fafc; /* stone-50 */
            --text-primary: #1f2937; /* gray-800 */
            --text-secondary: #4b5563; /* gray-600 */
            --accent-color: #2563eb; /* blue-600 */
            --accent-bg-light: #eff6ff; /* blue-50 */
            --card-bg: #ffffff;
            --border-color: #e5e7eb; /* gray-200 */
            --chart-line: #2563eb;
            --chart-fill: rgba(37, 99, 235, 0.2);
            --chart-point: #1e40af; /* blue-800 */
            --chart-grid: #f3f4f6; /* gray-100 */
            --tooltip-bg: #1f2937;
            --tooltip-title: #bfdbfe; /* blue-200 */
            --tooltip-body: #d1d5db; /* gray-300 */
            --button-bg: #2563eb;
            --button-text: #ffffff;
            --button-hover-bg: #1d4ed8; /* blue-700 */
            --danger-color: #dc2626; /* red-600 */
            --success-color: #16a34a; /* green-600 */
        }

        /* Dark Theme (Cyberpunk) */
        body.dark-theme {
            --bg-primary: #0a0a0a; /* gray-950 */
            --text-primary: #d8b4fe; /* purple-300 */
            --text-secondary: #a78bfa; /* violet-400 */
            --accent-color: #a855f7; /* purple-500 (new) */
            --accent-bg-light: rgba(168, 85, 247, 0.2); /* purple-500 with opacity (new) */
            --card-bg: #171717; /* gray-900 */
            --border-color: #4a0e4a; /* custom dark purple border */
            --chart-line: #a855f7; /* purple-500 (new) */
            --chart-fill: rgba(168, 85, 247, 0.2); /* purple-500 with opacity (new) */
            --chart-point: #a21caf; /* fuchsia-700 (new) */
            --chart-grid: #2d0c2d; /* custom dark purple grid */
            --tooltip-bg: #2d0c2d;
            --tooltip-title: #a855f7; /* purple-500 (new) */
            --tooltip-body: #d8b4fe;
            --button-bg: #a855f7; /* purple-500 (new) */
            --button-text: #171717;
            --button-hover-bg: #9333ea; /* purple-600 (new) */
            --danger-color: #ef4444; /* red-500 */
            --success-color: #22c55e; /* green-500 */
        }

        /* Apply variables to Tailwind-like classes */
        .bg-theme-primary { background-color: var(--bg-primary); }
        .text-theme-primary { color: var(--text-primary); }
        .text-theme-secondary { color: var(--text-secondary); }
        .bg-theme-card { background-color: var(--card-bg); }
        .border-theme-default { border-color: var(--border-color); }
        .text-theme-accent { color: var(--accent-color); }
        .bg-theme-accent-light { background-color: var(--accent-bg-light); }
        .bg-theme-button { background-color: var(--button-bg); }
        .text-theme-button { color: var(--button-text); }
        .hover\:bg-theme-button-hover:hover { background-color: var(--button-hover-bg); }
        .text-theme-danger { color: var(--danger-color); }
        .text-theme-success { color: var(--success-color); }

        /* Specific overrides for certain elements */
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }
        .container, .header, .nav, .day-card, .weekly-details, .strength-details, .cardio-section, .progress-section {
            background-color: var(--card-bg);
            border-color: var(--border-color);
        }
        .tab-active { border-color: var(--accent-color); color: var(--accent-color); background-color: var(--accent-bg-light); }
        .tab-inactive { border-color: transparent; color: var(--text-secondary); }
        .day-card-active { border-color: var(--accent-color); }
        .toggle-checkbox:checked + .toggle-label { background-color: var(--accent-color); }
        .toggle-checkbox:checked + .toggle-label .toggle-ball { transform: translateX(100%); }
        .focus\:ring-theme-accent:focus { --tw-ring-color: var(--accent-color); }
        .focus\:border-theme-accent:focus { border-color: var(--accent-color); }
        .text-sm-light { color: var(--text-secondary); } /* for small text that needs to be lighter */
        .text-xs-accent { color: var(--accent-color); } /* for small accent text */
        .bg-input-field { background-color: var(--bg-primary); } /* for input fields */
        .border-input-field { border-color: var(--border-color); } /* for input fields */
        .placeholder-theme-secondary::placeholder { color: var(--text-secondary); }

        /* Loading spinner styles */
        .loader {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="light-theme bg-theme-primary text-theme-primary">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-8">
            <div class="flex justify-end mb-4">
                <button id="theme-toggle" class="px-4 py-2 rounded-full bg-theme-button text-theme-button hover:bg-theme-button-hover transition-colors duration-300 font-semibold text-sm">
                    Cambiar Tema
                </button>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold text-theme-primary">Plan de Entrenamiento Interactivo</h1>
            <p class="text-theme-secondary mt-2 text-lg">Tu gu√≠a completa de fuerza y cardio. Selecciona una secci√≥n para comenzar.</p>
        </header>

        <nav class="flex justify-center border-b border-theme-default mb-8">
            <button id="btn-weekly" class="flex-1 sm:flex-none text-center font-semibold py-3 px-6 border-b-2 transition-all duration-300 tab-active">üóìÔ∏è Plan Semanal</button>
            <button id="btn-strength" class="flex-1 sm:flex-none text-center font-semibold py-3 px-6 border-b-2 transition-all duration-300 tab-inactive">üí™ Rutina de Fuerza</button>
            <button id="btn-cardio" class="flex-1 sm:flex-none text-center font-semibold py-3 px-6 border-b-2 transition-all duration-300 tab-inactive">üèÉ‚Äç‚ôÇÔ∏è Gu√≠a de Cardio</button>
            <button id="btn-progress" class="flex-1 sm:flex-none text-center font-semibold py-3 px-6 border-b-2 transition-all duration-300 tab-inactive">üìà Progreso</button>
        </nav>

        <main>
            <div id="loading-overlay" class="fixed inset-0 bg-theme-primary bg-opacity-90 flex flex-col items-center justify-center z-50 hidden">
                <div class="loader"></div>
                <p class="text-theme-primary mt-4 text-lg">Cargando datos...</p>
                <p class="text-theme-secondary text-sm mt-2">Esto puede tomar unos segundos.</p>
            </div>

            <div id="view-weekly">
                 <div class="text-center mb-8 p-6 bg-theme-card rounded-2xl shadow-sm border border-theme-default">
                    <h2 class="text-2xl font-bold text-theme-primary mb-2">Tu Semana de Entrenamiento</h2>
                    <p class="text-theme-secondary max-w-3xl mx-auto">Aqu√≠ tienes un resumen de tu plan de entrenamiento para toda la semana. Haz clic en cualquier d√≠a para ver los detalles completos del entrenamiento de fuerza y las instrucciones espec√≠ficas de cardio para esa sesi√≥n.</p>
                </div>
                <div id="weekly-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-7 gap-4 mb-8"></div>
                <div id="weekly-details" class="bg-theme-card p-6 rounded-2xl shadow-lg border border-theme-default min-h-[200px] transition-all duration-500">
                    <p class="text-theme-secondary text-center">Selecciona un d√≠a para ver los detalles aqu√≠.</p>
                </div>
            </div>

            <div id="view-strength" class="hidden">
                <div class="text-center mb-8 p-6 bg-theme-card rounded-2xl shadow-sm border border-theme-default">
                    <h2 class="text-2xl font-bold text-theme-primary mb-2">Explora tus Rutinas de Fuerza</h2>
                    <p class="text-theme-secondary max-w-3xl mx-auto">Elige un d√≠a de entrenamiento para ver los ejercicios. Puedes usar el interruptor para cambiar entre la rutina del gimnasio y la alternativa para hacer en casa.</p>
                </div>
                <div class="flex flex-col md:flex-row gap-8">
                    <div class="md:w-1/3">
                        <div class="flex justify-between items-center mb-4">
                             <h3 class="text-xl font-bold text-theme-primary">Modo de Entrenamiento</h3>
                             <div class="flex items-center cursor-pointer">
                                <span class="mr-3 font-semibold text-theme-secondary">Gimnasio</span>
                                <input type="checkbox" id="mode-toggle" class="toggle-checkbox hidden">
                                <label for="mode-toggle" class="toggle-label flex items-center h-6 w-12 rounded-full bg-theme-default p-1 transition-colors duration-300">
                                    <div class="toggle-ball h-4 w-4 rounded-full bg-white shadow-md transform transition-transform duration-300"></div>
                                </label>
                                <span class="ml-3 font-semibold text-theme-secondary">En Casa</span>
                            </div>
                        </div>
                        <div id="strength-days" class="flex flex-col gap-2"></div>
                    </div>
                    <div id="strength-details" class="bg-theme-card md:w-2/3 p-6 rounded-2xl shadow-lg border border-theme-default">
                         <p class="text-theme-secondary text-center">Selecciona un d√≠a para ver los ejercicios.</p>
                    </div>
                </div>
            </div>

            <div id="view-cardio" class="hidden">
                 <div class="text-center mb-8 p-6 bg-theme-card rounded-2xl shadow-sm border border-theme-default">
                    <h2 class="text-2xl font-bold text-theme-primary mb-2">Tu Gu√≠a Esencial de Cardio</h2>
                    <p class="text-theme-secondary max-w-3xl mx-auto">Esta secci√≥n detalla la estrategia de cardio dise√±ada para maximizar la quema de grasa sin comprometer tu recuperaci√≥n muscular. Incluye una visualizaci√≥n de la progresi√≥n de velocidad recomendada.</p>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-theme-card p-6 rounded-2xl shadow-lg border border-theme-default">
                        <h3 class="font-bold text-xl mb-4 text-theme-primary">Estrategia y Recomendaciones</h3>
                        <div class="space-y-4 text-theme-secondary">
                            <div>
                                <h4 class="font-semibold text-theme-accent">Contexto General</h4>
                                <ul class="list-disc list-inside mt-1 space-y-1">
                                    <li>Tu caminata diaria al gimnasio (~1.6 km) ya es un excelente cardio base.</li>
                                    <li>El objetivo es quemar grasa sin afectar la recuperaci√≥n ni la masa muscular.</li>
                                    <li>Usa la caminadora con inclinaci√≥n alta (15%) para un mayor gasto cal√≥rico sin impacto.</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-theme-accent">Cardio Principal: LISS Inclinado</h4>
                                <ul class="list-disc list-inside mt-1 space-y-1">
                                    <li><span class="font-bold">Qu√© es:</span> Cardio moderado en caminadora con 15% de inclinaci√≥n.</li>
                                    <li><span class="font-bold">Duraci√≥n:</span> 15 a 20 minutos post-entrenamiento.</li>
                                    <li><span class="font-bold">Ventajas:</span> Alta quema de calor√≠as, bajo impacto articular, sostenible a largo plazo.</li>
                                </ul>
                            </div>
                             <div>
                                <h4 class="font-semibold text-theme-accent">Recomendaciones Finales</h4>
                                <ul class="list-disc list-inside mt-1 space-y-1">
                                    <li>Limita el cardio extra a 3-4 veces por semana para una recuperaci√≥n √≥ptima.</li>
                                    <li>Escucha a tu cuerpo: si sientes fatiga, reduce la velocidad o la duraci√≥n.</li>
                                    <li>Los d√≠as de descanso son cruciales para la recuperaci√≥n muscular y del sistema nervioso.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="bg-theme-card p-6 rounded-2xl shadow-lg border border-theme-default">
                        <h3 class="font-bold text-xl mb-4 text-theme-primary">Progresi√≥n de Velocidad Visualizada</h3>
                        <p class="text-theme-secondary mb-4">Este gr√°fico muestra el aumento progresivo de la velocidad durante una sesi√≥n de 20 minutos en la caminadora con 15% de inclinaci√≥n. Pasa el cursor sobre los puntos para ver los detalles.</p>
                        <div class="chart-container relative h-80 md:h-96 w-full max-w-xl mx-auto">
                            <canvas id="cardioChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-progress" class="hidden">
                <div class="text-center mb-8 p-6 bg-theme-card rounded-2xl shadow-sm border border-theme-default">
                    <h2 class="text-2xl font-bold text-theme-primary mb-2">Tu Progreso en el Tiempo</h2>
                    <p class="text-theme-secondary max-w-3xl mx-auto">Registra tus m√©tricas clave y visualiza tus avances. Puedes a√±adir nuevas entradas y seleccionar qu√© m√©trica quieres ver en el gr√°fico.</p>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-theme-card p-6 rounded-2xl shadow-lg border border-theme-default">
                        <h3 class="font-bold text-xl mb-4 text-theme-primary">A√±adir Nueva Entrada</h3>
                        <form id="progress-form" class="space-y-4">
                            <div>
                                <label for="progress-date" class="block text-sm font-medium text-theme-secondary mb-1">Fecha:</label>
                                <input type="date" id="progress-date" class="w-full p-2 bg-input-field border border-input-field rounded-md focus:ring-theme-accent focus:border-theme-accent placeholder-theme-secondary" required>
                            </div>
                            <div>
                                <label for="progress-metric" class="block text-sm font-medium text-theme-secondary mb-1">M√©trica:</label>
                                <select id="progress-metric" class="w-full p-2 bg-input-field border border-input-field rounded-md focus:ring-theme-accent focus:border-theme-accent">
                                    <option value="bodyWeight">Peso Corporal (kg)</option>
                                    <option value="benchPress">Press de Banca (kg)</option>
                                </select>
                            </div>
                            <div>
                                <label for="progress-value" class="block text-sm font-medium text-theme-secondary mb-1">Valor:</label>
                                <input type="number" id="progress-value" class="w-full p-2 bg-input-field border border-input-field rounded-md focus:ring-theme-accent focus:border-theme-accent placeholder-theme-secondary" step="0.1" required>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="did-cardio" class="h-4 w-4 text-theme-accent border-input-field rounded focus:ring-theme-accent">
                                <label for="did-cardio" class="ml-2 block text-sm text-theme-primary">Hice Cardio</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="did-training" class="h-4 w-4 text-theme-accent border-input-field rounded focus:ring-theme-accent">
                                <label for="did-training" class="ml-2 block text-sm text-theme-primary">Hice Entrenamiento</label>
                            </div>
                            <button type="submit" class="w-full bg-theme-button text-theme-button py-2 px-4 rounded-md hover:bg-theme-button-hover transition-colors duration-300 font-semibold">A√±adir Progreso</button>
                        </form>
                    </div>
                    <div class="bg-theme-card p-6 rounded-2xl shadow-lg border border-theme-default">
                        <h3 class="font-bold text-xl mb-4 text-theme-primary">Visualizar Progreso</h3>
                        <div class="mb-4">
                            <label for="chart-metric-selector" class="block text-sm font-medium text-theme-secondary mb-1">Mostrar m√©trica:</label>
                            <select id="chart-metric-selector" class="w-full p-2 bg-input-field border border-input-field rounded-md focus:ring-theme-accent focus:border-theme-accent">
                                <option value="bodyWeight">Peso Corporal (kg)</option>
                                <option value="benchPress">Press de Banca (kg)</option>
                            </select>
                        </div>
                        <div class="chart-container relative h-80 md:h-96 w-full max-w-xl mx-auto">
                            <canvas id="progressChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="bg-theme-card p-6 rounded-2xl shadow-lg border border-theme-default mt-8">
                    <h3 class="font-bold text-xl mb-4 text-theme-primary">Historial de Progreso</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-theme-default">
                            <thead class="bg-theme-primary">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">Fecha</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">M√©trica</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">Valor</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">Cardio</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">Entrenamiento</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="progress-table-body" class="bg-theme-card divide-y divide-theme-default">
                                <tr><td colspan="6" class="text-center py-4 text-theme-secondary">No hay datos de progreso a√∫n.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="bg-theme-card p-6 rounded-2xl shadow-lg border border-theme-default mt-8">
                    <h3 class="font-bold text-xl mb-4 text-theme-primary">Resumen de Progreso</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-theme-default">
                            <thead class="bg-theme-primary">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">M√©trica</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">Inicio</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">Actual</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-theme-secondary uppercase tracking-wider">Cambio</th>
                                </tr>
                            </thead>
                            <tbody id="progress-summary-body" class="bg-theme-card divide-y divide-theme-default">
                                <tr><td colspan="4" class="text-center py-4 text-theme-secondary">No hay datos para el resumen.</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-4 text-theme-secondary">
                        <p><span class="font-semibold">D√≠as con Cardio Registrado:</span> <span id="total-cardio-days">0</span></p>
                        <p><span class="font-semibold">D√≠as con Entrenamiento Registrado:</span> <span id="total-training-days">0</span></p>
                    </div>
                </div>
            </div>
        </main>
    </div>

<script type="module">
document.addEventListener('DOMContentLoaded', async () => {
    const { initializeApp, getAuth, signInAnonymously, onAuthStateChanged, getFirestore, collection, addDoc, deleteDoc, onSnapshot, doc, query } = window.firebase;

    // Global Firebase instances
    let app;
    let db;
    let auth;
    let userId;
    let isAuthReady = false;

    // ** TU CONFIGURACI√ìN DE FIREBASE REAL VA AQU√ç **
    const firebaseConfig = {
      apiKey: "AIzaSyAurRdFffS1HZfZKpUW-cMr2YwWqb_0x3M",
      authDomain: "rutina-fb32d.firebaseapp.com",
      projectId: "rutina-fb32d",
      storageBucket: "rutina-fb32d.firebasestorage.app",
      messagingSenderId: "907394593748",
      appId: "1:907394593748:web:4b768ae28cd6d035cf9c41",
      measurementId: "G-C5MRSX4Y6W"
    };

    // Usamos el projectId como base para el appId en la ruta de Firestore.
    const appId = firebaseConfig.projectId; 

    const loadingOverlay = document.getElementById('loading-overlay');
    loadingOverlay.classList.remove('hidden');

    const data = {
        routines: {
            day1: { name: 'Pecho / Tr√≠ceps', icon: 'üéØ', gym: [{e: 'Press de banca', s: '4x8‚Äì12'}, {e: 'Press inclinado c/mancuerna', s: '3x10'}, {e: 'Fondos o press de pecho en m√°quina', s: '3x10'}, {e: 'Extensiones de tr√≠ceps en polea', s: '3x12'}], home: [{e: 'Flexiones o press c/mancuerna', s: '3x10‚Äì15'}, {e: 'Press inclinado c/mancuerna', s: '3x10'}, {e: 'Jalones de tr√≠ceps c/banda', s: '3x12'}, {e: 'El√≠ptica', s: '20 min (intensidad moderada)'}] },
            day2: { name: 'Espalda / B√≠ceps', icon: 'üèπ', gym: [{e: 'Remo con barra', s: '4x8'}, {e: 'Jal√≥n al pecho', s: '3x10'}, {e: 'Dominadas asistidas', s: '3x6-8'}, {e: 'Curl de b√≠ceps con barra', s: '3x10'}, {e: 'Curl martillo c/mancuerna', s: '3x12'}], home: [{e: 'Remo con mancuerna (cada brazo)', s: '4x8'}, {e: 'Jal√≥n con ligas', s: '3x10'}, {e: 'Dominadas negativas o c/banda', s: '3x6'}, {e: 'Curl b√≠ceps c/mancuerna', s: '3x12'}, {e: 'El√≠ptica', s: '20 min'}] },
            day3: { name: 'Piernas / Core', icon: 'ÔøΩ', gym: [{e: 'Sentadilla (Smith o libre)', s: '4x10'}, {e: 'Prensa de piernas', s: '3x10'}, {e: 'Peso muerto rumano', s: '3x8'}, {e: 'Extensiones de pierna', s: '3x12'}, {e: 'Plancha 3x30s, Crunches 3x15', s: ''}], home: [{e: 'Sentadilla goblet c/mancuerna', s: '4x12'}, {e: 'Zancadas c/mancuerna (cada pierna)', s: '3x10'}, {e: 'Peso muerto a una pierna c/mancuerna', s: '3x8'}, {e: 'Crunch y plancha', s: '3x12‚Äì15'}, {e: 'El√≠ptica', s: '20 min'}] },
            day4: { name: 'Hombros / Trapecio', icon: '‚õ∞Ô∏è', gym: [{e: 'Press militar c/barra o mancuerna', s: '4x8'}, {e: 'Elevaciones laterales', s: '3x12'}, {e: 'Remo al ment√≥n', s: '3x10'}, {e: 'Encogimientos c/mancuerna', s: '3x12'}], home: [{e: 'Press hombros c/mancuerna', s: '4x10'}, {e: 'Elevaciones laterales', s: '3x15'}, {e: 'Press tras nuca c/banda', s: '3x12'}, {e: 'Remo al ment√≥n c/mancuerna', s: '3x10'}, {e: 'El√≠ptica', s: '20 min'}] },
            day5: { name: 'Brazos', icon: 'üí™', gym: [{e: 'Curl b√≠ceps con barra', s: '4x10'}, {e: 'Curl concentrado', s: '3x12'}, {e: 'Fondos de tr√≠ceps en banco', s: '3x10'}, {e: 'Patada de tr√≠ceps', s: '3x12'}, {e: 'Abdominales bicicleta', s: '3x15'}], home: [{e: 'Curl de b√≠ceps c/mancuerna', s: '4x12'}, {e: 'Curl martillo', s: '3x12'}, {e: 'Extensi√≥n de tr√≠ceps tumbado c/mancuerna', s: '3x10'}, {e: 'Jal√≥n de tr√≠ceps c/banda', s: '3x15'}, {e: 'El√≠ptica', s: '20 min'}] },
        },
        weeklyPlan: [
            { day: 'D√≠a 1', routineKey: 'day1', cardio: 'Caminata en cinta 15% inclinaci√≥n, 15-20 min (velocidad progresiva).' },
            { day: 'D√≠a 2', routineKey: 'day2', cardio: 'Solo caminata diaria (1.6 km ida y vuelta). Sin cardio extra.' },
            { day: 'D√≠a 3', routineKey: 'day3', cardio: 'Caminata en cinta 10-12% inclinaci√≥n, 15 min, ritmo moderado (4.5-6 km/h).' },
            { day: 'D√≠a 4', routineKey: 'day4', cardio: 'Solo caminata diaria. Sin cardio extra.' },
            { day: 'D√≠a 5', routineKey: 'day5', cardio: 'Caminata en cinta 15% inclinaci√≥n, 15 min (4 a 8 km/h progresivo).' },
            { day: 'D√≠a 6', routineKey: null, cardio: 'Descanso o solo caminata diaria. Sin cardio extra.' },
            { day: 'D√≠a 7', routineKey: null, cardio: 'Descanso o solo caminata diaria. Sin cardio extra.' }
        ],
        cardioProgression: {
            labels: ['0', '3', '6', '9', '12', '15', '17', '20'],
            data: [4.0, 5.0, 6.0, 7.0, 8.0, 8.5, 5.0, 4.0],
            notes: ['Calentamiento', 'Intensidad Creciente', 'Ritmo Moderado', 'Ritmo Exigente', 'Ritmo Fuerte', '√öltimo Empuj√≥n', 'Enfriamiento', 'Fin']
        },
        progressEntries: [] // This will be populated by Firestore
    };

    const views = {
        weekly: document.getElementById('view-weekly'),
        strength: document.getElementById('view-strength'),
        cardio: document.getElementById('view-cardio'),
        progress: document.getElementById('view-progress')
    };

    const buttons = {
        weekly: document.getElementById('btn-weekly'),
        strength: document.getElementById('btn-strength'),
        cardio: document.getElementById('btn-cardio'),
        progress: document.getElementById('btn-progress')
    };

    const weeklyGrid = document.getElementById('weekly-grid');
    const weeklyDetails = document.getElementById('weekly-details');
    const strengthDaysContainer = document.getElementById('strength-days');
    const strengthDetails = document.getElementById('strength-details');
    const modeToggle = document.getElementById('mode-toggle');
    const progressForm = document.getElementById('progress-form');
    const progressDateInput = document.getElementById('progress-date');
    const progressMetricInput = document.getElementById('progress-metric');
    const progressValueInput = document.getElementById('progress-value');
    const didCardioInput = document.getElementById('did-cardio');
    const didTrainingInput = document.getElementById('did-training');
    const progressTableBody = document.getElementById('progress-table-body');
    const chartMetricSelector = document.getElementById('chart-metric-selector');
    const progressSummaryBody = document.getElementById('progress-summary-body');
    const totalCardioDaysSpan = document.getElementById('total-cardio-days');
    const totalTrainingDaysSpan = document.getElementById('total-training-days');
    const themeToggleButton = document.getElementById('theme-toggle');
    const body = document.body;

    let activeView = 'weekly';
    let activeStrengthDay = 'day1';
    let currentMode = 'gym';
    let cardioChartInstance = null;
    let progressChartInstance = null;
    let activeWeeklyDayCard = null;

    async function initializeFirebase() {
        try {
            // Validar que la configuraci√≥n esencial de Firebase est√© presente
            if (!firebaseConfig || !firebaseConfig.apiKey || !firebaseConfig.authDomain || !firebaseConfig.projectId) {
                throw new Error("Configuraci√≥n de Firebase incompleta. Aseg√∫rate de que apiKey, authDomain y projectId est√©n definidos.");
            }

            console.log("Intentando inicializar Firebase con la configuraci√≥n:", firebaseConfig);
            app = initializeApp(firebaseConfig);
            console.log("Aplicaci√≥n Firebase inicializada:", app);

            db = getFirestore(app);
            console.log("Firestore inicializado:", db);

            auth = getAuth(app);
            console.log("Autenticaci√≥n inicializada:", auth);

            // Intentar autenticaci√≥n an√≥nima
            try {
                await signInAnonymously(auth);
                userId = auth.currentUser?.uid || crypto.randomUUID(); // Fallback por si acaso
                console.log("Firebase inicializado y usuario autenticado (an√≥nimamente):", userId);
                isAuthReady = true;
                
                // Inicia la escucha de datos de Firestore una vez autenticado
                setupFirestoreListener();
                loadingOverlay.classList.add('hidden'); // Oculta el overlay de carga
            } catch (authError) {
                console.error("Error en autenticaci√≥n an√≥nima:", authError);
                // Manejar error espec√≠fico de autenticaci√≥n
                if (authError.code === 'auth/operation-not-allowed') {
                    throw new Error("La autenticaci√≥n an√≥nima no est√° habilitada en Firebase Console. Por favor habil√≠tala en Authentication > Sign-in Methods.");
                } else {
                    throw new Error("Error de autenticaci√≥n: " + authError.message);
                }
            }
        } catch (error) {
            console.error("Error al inicializar Firebase:", error);
            // Mensaje de error m√°s espec√≠fico para el usuario
            loadingOverlay.innerHTML = `<div class="bg-theme-card p-6 rounded-xl max-w-md text-center">
                <h3 class="font-bold text-xl mb-4 text-theme-danger">Error al conectar con Firebase</h3>
                <p class="text-theme-secondary mb-4">${error.message}</p>
                <p class="text-theme-secondary text-sm">Por favor verifica la configuraci√≥n y aseg√∫rate de que la autenticaci√≥n an√≥nima est√° habilitada en Firebase Console.</p>
            </div>`;
        }
    }

    function setupFirestoreListener() {
        if (!isAuthReady || !db || !userId) {
            console.warn("Firestore listener no est√° listo: Autenticaci√≥n o DB no inicializada.");
            return;
        }
        // La ruta de la colecci√≥n ahora usa el appId que se define globalmente
        const progressCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/progressEntries`);
        const q = query(progressCollectionRef);

        onSnapshot(q, (snapshot) => {
            data.progressEntries = []; // Limpia los datos existentes
            snapshot.forEach((doc) => {
                data.progressEntries.push({ id: doc.id, ...doc.data() });
            });
            console.log("Entradas de progreso actualizadas desde Firestore:", data.progressEntries);
            // Vuelve a renderizar la UI con los nuevos datos
            renderProgressTable();
            renderProgressChart();
            renderProgressSummary();
        }, (error) => {
            console.error("Error al obtener entradas de progreso:", error);
            // Opcionalmente, muestra un mensaje de error al usuario
        });
    }

    async function addProgressEntryToFirestore(entry) {
        if (!isAuthReady || !db || !userId) {
            console.error("Firestore no est√° listo para a√±adir datos.");
            alert("Error: La base de datos no est√° lista. Int√©ntalo de nuevo m√°s tarde.");
            return;
        }
        try {
            // La ruta de la colecci√≥n ahora usa el appId que se define globalmente
            await addDoc(collection(db, `artifacts/${appId}/users/${userId}/progressEntries`), entry);
            console.log("Documento escrito con √©xito!");
        } catch (error) {
            console.error("Error al a√±adir documento:", error);
            alert("Error al a√±adir el progreso: " + error.message);
        }
    }

    async function deleteProgressEntryFromFirestore(docId) {
        if (!isAuthReady || !db || !userId) {
            console.error("Firestore no est√° listo para eliminar datos.");
            alert("Error: La base de datos no est√° lista. Int√©ntalo de nuevo m√°s tarde.");
            return;
        }
        try {
            // La ruta del documento ahora usa el appId que se define globalmente
            await deleteDoc(doc(db, `artifacts/${appId}/users/${userId}/progressEntries`, docId));
            console.log("Documento eliminado con √©xito!");
        } catch (error) {
            console.error("Error al eliminar documento:", error);
            alert("Error al eliminar el progreso: " + error.message);
        }
    }

    // ... el resto del c√≥digo JavaScript permanece igual ...

    buttons.weekly.addEventListener('click', () => switchView('weekly'));
    buttons.strength.addEventListener('click', () => switchView('strength'));
    buttons.cardio.addEventListener('click', () => switchView('cardio'));
    buttons.progress.addEventListener('click', () => switchView('progress'));
    modeToggle.addEventListener('change', (e) => {
        currentMode = e.target.checked ? 'home' : 'gym';
        renderStrengthDetails();
    });

    progressForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const date = progressDateInput.value;
        const metric = progressMetricInput.value;
        const value = parseFloat(progressValueInput.value);
        const didCardio = didCardioInput.checked;
        const didTraining = didTrainingInput.checked;

        if (date && metric && !isNaN(value)) {
            addProgressEntryToFirestore({ date, type: metric, value, didCardio, didTraining });
            progressForm.reset();
            progressDateInput.valueAsDate = new Date(); // Reset date to today after submission
        } else {
            alert('Por favor, completa todos los campos para a√±adir el progreso.');
        }
    });

    chartMetricSelector.addEventListener('change', () => {
        renderProgressChart();
    });

    themeToggleButton.addEventListener('click', () => {
        if (body.classList.contains('light-theme')) {
            setTheme('dark-theme');
        } else {
            setTheme('light-theme');
        }
    });

    function init() {
        const savedTheme = localStorage.getItem('theme') || 'light-theme';
        setTheme(savedTheme);

        renderWeeklyPlan();
        renderStrengthDays();
        renderStrengthDetails();
        switchView('weekly');
        document.querySelector('.day-card').click();
        progressDateInput.valueAsDate = new Date(); // Set default date to today

        initializeFirebase(); // Start Firebase initialization
    }
    
    init();
});
</script>

</body>
</html>
